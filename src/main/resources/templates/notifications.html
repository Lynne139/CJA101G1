<!DOCTYPE html>
<html lang="zh-Hant" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>我的通知</title>
    <link rel="stylesheet" th:href="@{/homepage/vendor/bootstrap/bootstrap.min.css}">
    <link rel="stylesheet" th:href="@{/homepage/css/style.css}">
</head>
<body>

<!-- Header -->
<div th:replace="~{fragments/header :: header}"></div>

<section class="section" style="padding: 60px 0; background-color: #fdf6ef;">
    <div class="container">
        <h2 class="text-center mb-4">系統通知</h2>

        <div th:if="${notificationPage.totalElements == 0}">
            <p class="text-center">目前沒有任何通知。</p>
        </div>

        <div th:if="${notificationPage.totalElements > 0}">
            <div class="list-group">
                <div th:each="note : ${notificationPage.content}" class="list-group-item list-group-item-action mb-3"
                     th:classappend="${note.isRead} ? 'list-group-item-light' : 'list-group-item-warning'">
                    <h5 class="mb-1" th:text="${note.title}">通知標題</h5>
                    <p class="mb-1" th:text="${note.content}">通知內容</p>
                    <small th:text="${#temporals.format(note.createdAt, 'yyyy-MM-dd HH:mm')}">建立時間</small>

                    <!-- 新增：設為已讀按鈕，若已讀則不顯示 -->
                    <div th:if="${!note.isRead}" class="mt-2">
                        <form th:action="@{'/notifications/' + ${note.notificationId} + '/read'}" method="post">
                            <input type="hidden" name="memberId" th:value="${memberId}" />
                            <button type="submit" class="btn btn-sm btn-primary">設為已讀</button>
                        </form>
                    </div>
                </div>
            </div>

            <!-- 分頁控制 -->
            <nav aria-label="通知分頁" class="mt-4">
                <ul class="pagination justify-content-center">
                    <li class="page-item" th:classappend="${notificationPage.first} ? 'disabled'">
                        <a class="page-link"
                           th:href="@{|/notifications/member/${memberId}?page=${notificationPage.number - 1}|}">上一頁</a>
                    </li>
                    <li class="page-item" th:each="i : ${#numbers.sequence(0, notificationPage.totalPages - 1)}"
                        th:classappend="${i == notificationPage.number} ? 'active'">
                        <a class="page-link"
                           th:href="@{|/notifications/member/${memberId}?page=${i}|}"
                           th:text="${i + 1}">1</a>
                    </li>
                    <li class="page-item" th:classappend="${notificationPage.last} ? 'disabled'">
                        <a class="page-link"
                           th:href="@{|/notifications/member/${memberId}?page=${notificationPage.number + 1}|}">下一頁</a>
                    </li>
                </ul>
            </nav>
        </div>
    </div>
</section>

<!-- Footer -->
<div th:replace="~{fragments/footer :: footer}"></div>

</body>
</html>
