<header th:fragment="header" class="d-flex justify-content-between align-items-center p-3">
  <div class="fw-bold text-brown">Maison d’Yuko</div>
    <div class="menu-img-div">
      <a href="#" id="menuToggle" class="ml-3"><img th:src="@{/images/icon/menu.svg}" alt="menu" class="menu-img" /></a>
    </div>
    <div class="d-flex">
      <div class="d-flex align-items-center gap-3">
        <a href="#" id="menu-Toggle" class="ml-lg-3">☰ MENU</a>
        <span class="mx-3"></span>
        <img th:src="@{/images/icon/member.svg}" alt="member" class="logo-header" />

<!-- 登入/登出切換區 -->
<div th:if="${loggedInMember == null}">
    <button type="button" class="btn btn-link p-0 m-0 text-dark text-decoration-none" data-bs-toggle="modal" data-bs-target="#loginModal">
        會員登入
    </button>
</div>

<div th:if="${loggedInMember != null}">
    <span th:text="'歡迎，' + ${loggedInMember.memberName} + '！'" class="me-2"></span>
    <a th:href="@{/member/logout}" class="btn btn-link p-0 m-0 text-dark text-decoration-none">
        會員登出
    </a>
</div>

<!-- 登入Modal區塊 -->
<div th:class="'modal fade' + (${error} != null ? ' show d-block' : '')"
     id="loginModal" tabindex="-1" aria-labelledby="loginModalLabel"
     th:attr="style=${error} != null ? 'display:block;' : 'display:none;'">

  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      
      <div class="modal-header">
        <h5 class="modal-title" id="loginModalLabel">會員登入</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="關閉"></button>
      </div>
      
      <div class="modal-body">
        <!-- 登入表單 -->
        <div class="container">
            
            <!-- 錯誤訊息顯示 -->
            <div th:if="${error}" class="alert alert-danger" th:text="${error}"></div>

           <form id="loginForm">
			    <div class="mb-3">
			        <label for="memberEmail" class="form-label">電子信箱</label>
			        <input type="email" class="form-control" id="memberEmail" name="memberEmail" required>
			    </div>
			
			    <div class="mb-3">
			        <label for="memberPassword" class="form-label">密碼</label>
			        <input type="password" class="form-control" id="memberPassword" name="memberPassword" required>
			    </div>
			
			    <div id="loginError" class="text-danger mb-2"></div>
			
			    <div class="d-grid">
			        <button type="submit" class="btn btn-primary">登入</button>
			    </div>
			</form>


        </div>
      </div>

    </div>
  </div>
</div>

      </div>
    </div>
    <script>
		document.addEventListener('DOMContentLoaded', function () {
		    const form = document.getElementById('loginForm');
		    const errorDiv = document.getElementById('loginError');
		
		    form.addEventListener('submit', function (e) {
		        e.preventDefault();
		
		        const formData = new FormData(form);
		
		        fetch('/member/ajaxLogin', {
		            method: 'POST',
		            body: formData,
		        })
		        .then(response => response.json())
		        .then(data => {
		            if (data.success) {
		                // 關閉 modal
		                const modal = bootstrap.Modal.getInstance(document.getElementById('loginModal'));
		                modal.hide();
		
		                // 重新整理或更新頁面
		                window.location.reload();
		            } else {
		                errorDiv.textContent = data.message || "登入失敗";
		            }
		        })
		        .catch(err => {
		            errorDiv.textContent = "伺服器錯誤，請稍後再試。";
		        });
		    });
		});
	</script>
    
    
</header>