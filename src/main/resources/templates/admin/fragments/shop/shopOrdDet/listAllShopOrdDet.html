<div th:fragment="listAllShopOrdDet-div">
    <div class="panel">
        <div class="d-flex justify-content-between align-items-center mb-3">
            <h2 class="panel-title">訂單明細列表</h2>
            <div class="d-flex align-items-center">
                <div id="tableLoading" class="me-3">
                    <div class="spinner-border spinner-border-sm" role="status">
                        <span class="visually-hidden">載入中...</span>
                    </div>
                </div>
                <span class="text-muted small">載入中...</span>
            </div>
        </div>
        
        <div id="tableContainer" style="display: none;">
            <div class="table-responsive">
                <table id="shopOrdDetTable" class="table table-striped table-hover">
                    <thead class="table-dark">
                        <tr>
                            <th>訂單編號</th>
                            <th>商品編號</th>
                            <th>商品名稱</th>
                            <th>購買價格</th>
                            <th>數量</th>
                            <th>小計</th>
                            <th>操作</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr th:each="shopOrdDetVO : ${shopOrdDetListData}">
                            <td th:text="${shopOrdDetVO.shopOrdVO.prodOrdId}"></td>
                            <td th:text="${shopOrdDetVO.prodVO.productId}"></td>
                            <td th:text="${shopOrdDetVO.prodVO.productName}"></td>
                            <td th:text="${'$' + shopOrdDetVO.purchasePrice}"></td>
                            <td th:text="${shopOrdDetVO.prodQuantity}"></td>
                            <td th:text="${'$' + (shopOrdDetVO.purchasePrice * shopOrdDetVO.prodQuantity)}"></td>
                            <td>
                                <div class="btn-group" role="group">
                                    <button type="button" class="btn btn-outline-primary btn-sm" 
                                            data-bs-toggle="modal" data-bs-target="#editShopOrdDetModal"
                                            th:data-prod-ord-id="${shopOrdDetVO.shopOrdVO.prodOrdId}"
                                            th:data-product-id="${shopOrdDetVO.prodVO.productId}"
                                            onclick="loadEditShopOrdDetModal(this)">
                                        <i class="fas fa-edit me-1"></i>
                                        修改
                                    </button>
                                    <button type="button" class="btn btn-outline-danger btn-sm"
                                            th:onclick="'deleteShopOrdDet(' + ${shopOrdDetVO.shopOrdVO.prodOrdId} + ', ' + ${shopOrdDetVO.prodVO.productId} + ')'">
                                        <i class="fas fa-trash me-1"></i>
                                        刪除
                                    </button>
                                </div>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<script>
// 刪除訂單明細
function deleteShopOrdDet(prodOrdId, productId) {
    if (confirm('確定要刪除這筆訂單明細嗎？')) {
        // 建立表單並提交
        const form = document.createElement('form');
        form.method = 'POST';
        form.action = '/admin/shopOrdDet/delete';
        
        const prodOrdIdInput = document.createElement('input');
        prodOrdIdInput.type = 'hidden';
        prodOrdIdInput.name = 'prodOrdId';
        prodOrdIdInput.value = prodOrdId;
        
        const productIdInput = document.createElement('input');
        productIdInput.type = 'hidden';
        productIdInput.name = 'productId';
        productIdInput.value = productId;
        
        form.appendChild(prodOrdIdInput);
        form.appendChild(productIdInput);
        document.body.appendChild(form);
        form.submit();
    }
}
</script> 